{"version":3,"file":"search.min.js","names":["isMobile: boolean","isResultsPage: boolean","categoryButtons: HTMLButtonElement[]","form: HTMLFormElement | null"],"sources":["../../../../../client/simple/src/js/main/search.ts"],"sourcesContent":["// SPDX-License-Identifier: AGPL-3.0-or-later\r\n\r\nimport { assertElement, listen, settings } from \"../core/toolkit.ts\";\r\n\r\nconst submitIfQuery = (qInput: HTMLInputElement): void => {\r\n  if (qInput.value.length > 0) {\r\n    const search = document.getElementById(\"search\") as HTMLFormElement | null;\r\n    search?.submit();\r\n  }\r\n};\r\n\r\nconst updateClearButton = (qInput: HTMLInputElement, cs: HTMLElement): void => {\r\n  cs.classList.toggle(\"empty\", qInput.value.length === 0);\r\n};\r\n\r\nconst createClearButton = (qInput: HTMLInputElement): void => {\r\n  const cs = document.getElementById(\"clear_search\");\r\n  assertElement(cs);\r\n\r\n  updateClearButton(qInput, cs);\r\n\r\n  listen(\"click\", cs, (event: MouseEvent) => {\r\n    event.preventDefault();\r\n    qInput.value = \"\";\r\n    qInput.focus();\r\n    updateClearButton(qInput, cs);\r\n  });\r\n\r\n  listen(\"input\", qInput, () => updateClearButton(qInput, cs), { passive: true });\r\n};\r\n\r\nconst qInput = document.getElementById(\"q\") as HTMLInputElement | null;\r\nassertElement(qInput);\r\n\r\nconst isMobile: boolean = window.matchMedia(\"(max-width: 50em)\").matches;\r\nconst isResultsPage: boolean = document.querySelector(\"main\")?.id === \"main_results\";\r\n\r\n// focus search input on large screens\r\nif (!(isMobile || isResultsPage)) {\r\n  qInput.focus();\r\n}\r\n\r\n// On mobile, move cursor to the end of the input on focus\r\nif (isMobile) {\r\n  listen(\"focus\", qInput, () => {\r\n    // Defer cursor move until the next frame to prevent a visual jump\r\n    requestAnimationFrame(() => {\r\n      const end = qInput.value.length;\r\n      qInput.setSelectionRange(end, end);\r\n      qInput.scrollLeft = qInput.scrollWidth;\r\n    });\r\n  });\r\n}\r\n\r\ncreateClearButton(qInput);\r\n\r\n// Additionally to searching when selecting a new category, we also\r\n// automatically start a new search request when the user changes a search\r\n// filter (safesearch, time range or language) (this requires JavaScript\r\n// though)\r\nif (\r\n  settings.search_on_category_select &&\r\n  // If .search_filters is undefined (invisible) we are on the homepage and\r\n  // hence don't have to set any listeners\r\n  document.querySelector(\".search_filters\")\r\n) {\r\n  const safesearchElement = document.getElementById(\"safesearch\");\r\n  if (safesearchElement) {\r\n    listen(\"change\", safesearchElement, () => submitIfQuery(qInput));\r\n  }\r\n\r\n  const timeRangeElement = document.getElementById(\"time_range\");\r\n  if (timeRangeElement) {\r\n    listen(\"change\", timeRangeElement, () => submitIfQuery(qInput));\r\n  }\r\n\r\n  const languageElement = document.getElementById(\"language\");\r\n  if (languageElement) {\r\n    listen(\"change\", languageElement, () => submitIfQuery(qInput));\r\n  }\r\n}\r\n\r\nconst categoryButtons: HTMLButtonElement[] = [\r\n  ...document.querySelectorAll<HTMLButtonElement>(\"button.category_button\")\r\n];\r\nfor (const button of categoryButtons) {\r\n  listen(\"click\", button, (event: MouseEvent) => {\r\n    if (event.shiftKey) {\r\n      event.preventDefault();\r\n      button.classList.toggle(\"selected\");\r\n      return;\r\n    }\r\n\r\n    // deselect all other categories\r\n    for (const categoryButton of categoryButtons) {\r\n      categoryButton.classList.toggle(\"selected\", categoryButton === button);\r\n    }\r\n  });\r\n}\r\n\r\nconst form: HTMLFormElement | null = document.querySelector<HTMLFormElement>(\"#search\");\r\nassertElement(form);\r\n\r\n// override form submit action to update the actually selected categories\r\nlisten(\"submit\", form, (event: Event) => {\r\n  event.preventDefault();\r\n\r\n  const categoryValuesInput = document.querySelector<HTMLInputElement>(\"#selected-categories\");\r\n  if (categoryValuesInput) {\r\n    const categoryValues = categoryButtons\r\n      .filter((button) => button.classList.contains(\"selected\"))\r\n      .map((button) => button.name.replace(\"category_\", \"\"));\r\n\r\n    categoryValuesInput.value = categoryValues.join(\",\");\r\n  }\r\n\r\n  form.submit();\r\n});\r\n"],"mappings":"wDAIA,IAAM,EAAiB,GAAmC,CACpD,EAAO,MAAM,OAAS,GACT,SAAS,eAAe,SAAS,EACxC,QAAQ,EAId,GAAqB,EAA0B,IAA0B,CAC7E,EAAG,UAAU,OAAO,QAAS,EAAO,MAAM,SAAW,EAAE,EAGnD,EAAqB,GAAmC,CAC5D,IAAM,EAAK,SAAS,eAAe,eAAe,CAClD,EAAc,EAAG,CAEjB,EAAkB,EAAQ,EAAG,CAE7B,EAAO,QAAS,EAAK,GAAsB,CACzC,EAAM,gBAAgB,CACtB,EAAO,MAAQ,GACf,EAAO,OAAO,CACd,EAAkB,EAAQ,EAAG,EAC7B,CAEF,EAAO,QAAS,MAAc,EAAkB,EAAQ,EAAG,CAAE,CAAE,QAAS,GAAM,CAAC,EAG3E,EAAS,SAAS,eAAe,IAAI,CAC3C,EAAc,EAAO,CAErB,IAAMA,EAAoB,OAAO,WAAW,oBAAoB,CAAC,QAC3DC,EAAyB,SAAS,cAAc,OAAO,EAAE,KAAO,eAyBtE,GAtBM,GAAY,GAChB,EAAO,OAAO,CAIZ,GACF,EAAO,QAAS,MAAc,CAE5B,0BAA4B,CAC1B,IAAM,EAAM,EAAO,MAAM,OACzB,EAAO,kBAAkB,EAAK,EAAI,CAClC,EAAO,WAAa,EAAO,aAC3B,EACF,CAGJ,EAAkB,EAAO,CAOvB,EAAS,2BAGT,SAAS,cAAc,kBAAkB,CACzC,CACA,IAAM,EAAoB,SAAS,eAAe,aAAa,CAC3D,GACF,EAAO,SAAU,MAAyB,EAAc,EAAO,CAAC,CAGlE,IAAM,EAAmB,SAAS,eAAe,aAAa,CAC1D,GACF,EAAO,SAAU,MAAwB,EAAc,EAAO,CAAC,CAGjE,IAAM,EAAkB,SAAS,eAAe,WAAW,CACvD,GACF,EAAO,SAAU,MAAuB,EAAc,EAAO,CAAC,CAIlE,IAAMC,EAAuC,CAC3C,GAAG,SAAS,iBAAoC,yBAAyB,CAC1E,CACD,IAAK,IAAM,KAAU,EACnB,EAAO,QAAS,EAAS,GAAsB,CAC7C,GAAI,EAAM,SAAU,CAClB,EAAM,gBAAgB,CACtB,EAAO,UAAU,OAAO,WAAW,CACnC,OAIF,IAAK,IAAM,KAAkB,EAC3B,EAAe,UAAU,OAAO,WAAY,IAAmB,EAAO,EAExE,CAGJ,IAAMC,EAA+B,SAAS,cAA+B,UAAU,CACvF,EAAc,EAAK,CAGnB,EAAO,SAAU,EAAO,GAAiB,CACvC,EAAM,gBAAgB,CAEtB,IAAM,EAAsB,SAAS,cAAgC,uBAAuB,CACxF,IAKF,EAAoB,MAJG,EACpB,OAAQ,GAAW,EAAO,UAAU,SAAS,WAAW,CAAC,CACzD,IAAK,GAAW,EAAO,KAAK,QAAQ,YAAa,GAAG,CAAC,CAEb,KAAK,IAAI,EAGtD,EAAK,QAAQ,EACb"}